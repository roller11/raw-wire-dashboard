# RawWire Dashboard API Documentation

## Overview

The RawWire Dashboard provides a RESTful API for retrieving, filtering, and managing content. The API supports modular search filters, authentication, and rate limiting.

**Base URL**: `https://your-site.com/wp-json/rawwire/v1`

**Version**: 1.0

## Authentication

### Methods

#### 1. WordPress Session (Browser/Dashboard)
When logged in to WordPress admin, requests are automatically authenticated based on user capabilities.

#### 2. Bearer Token (External Clients)
For external API clients, include an Authorization header:

```http
Authorization: Bearer your_api_key_here
```

### Getting an API Key

API keys must be generated by a WordPress administrator. Contact your system administrator to obtain an API key.

## Endpoints

### GET /content

Retrieve content items with optional filtering and search.

#### Request

```http
GET /wp-json/rawwire/v1/content?status=approved&limit=20&offset=0
```

#### Query Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `status` | string | No | Filter by status: `pending`, `approved`, `rejected`, `published` |
| `limit` | integer | No | Number of items to return (1-100, default: 10) |
| `offset` | integer | No | Number of items to skip for pagination (default: 0) |
| `category` | string | No | Filter by category (comma-separated for multiple) |
| `q` | string | No | Search keyword in title, content, and summary |
| `after` | string | No | Return content published after this date (YYYY-MM-DD) |
| `before` | string | No | Return content published before this date (YYYY-MM-DD) |
| `min_relevance` | number | No | Minimum relevance score (0.0-1.0) |

#### Response

```json
{
  "items": [
    {
      "id": 123,
      "title": "Content Title",
      "published_at": "2026-01-01 12:00:00",
      "category": "news",
      "relevance": 0.85,
      "status": "approved"
    }
  ],
  "pagination": {
    "limit": 20,
    "offset": 0,
    "total": 150,
    "pages": 8
  }
}
```

#### Example Requests

**Get approved content:**
```bash
curl -X GET "https://your-site.com/wp-json/rawwire/v1/content?status=approved" \
  -H "Authorization: Bearer your_api_key"
```

**Search for keyword:**
```bash
curl -X GET "https://your-site.com/wp-json/rawwire/v1/content?q=federal+register" \
  -H "Authorization: Bearer your_api_key"
```

**Filter by date range:**
```bash
curl -X GET "https://your-site.com/wp-json/rawwire/v1/content?after=2026-01-01&before=2026-01-31" \
  -H "Authorization: Bearer your_api_key"
```

**Filter by category:**
```bash
curl -X GET "https://your-site.com/wp-json/rawwire/v1/content?category=policy,regulation" \
  -H "Authorization: Bearer your_api_key"
```

**Filter by relevance:**
```bash
curl -X GET "https://your-site.com/wp-json/rawwire/v1/content?min_relevance=0.8" \
  -H "Authorization: Bearer your_api_key"
```

---

### POST /content/approve

Approve one or more content items.

**Requires**: Write permission

#### Request

```http
POST /wp-json/rawwire/v1/content/approve
Content-Type: application/json

{
  "content_ids": [123, 456, 789],
  "notes": "Approved for publication"
}
```

#### Body Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `content_ids` | array | Yes | Array of content IDs to approve |
| `notes` | string | No | Optional approval notes |

#### Response

```json
{
  "approved": [123, 456, 789],
  "approved_count": 3
}
```

If some items fail:

```json
{
  "approved": [123, 456],
  "approved_count": 2,
  "failed": [
    {
      "id": 789,
      "error": "Content not found"
    }
  ],
  "failed_count": 1
}
```

#### Example Request

```bash
curl -X POST "https://your-site.com/wp-json/rawwire/v1/content/approve" \
  -H "Authorization: Bearer your_api_key" \
  -H "Content-Type: application/json" \
  -d '{
    "content_ids": [123, 456],
    "notes": "Approved for AI processing"
  }'
```

---

### GET /stats

Get content statistics.

#### Request

```http
GET /wp-json/rawwire/v1/stats
```

#### Response

```json
{
  "total": 500,
  "by_status": {
    "pending": 120,
    "approved": 300,
    "rejected": 50,
    "published": 30
  },
  "last_updated": "2026-01-01 15:30:00",
  "timestamp": "2026-01-01 16:00:00"
}
```

#### Example Request

```bash
curl -X GET "https://your-site.com/wp-json/rawwire/v1/stats" \
  -H "Authorization: Bearer your_api_key"
```

---

## Rate Limiting

API requests are rate-limited to prevent abuse:

- **Read operations** (GET): 120 requests per minute
- **Write operations** (POST): 30 requests per minute

Rate limits are tracked per user (if authenticated) or per IP address (for anonymous requests).

### Rate Limit Response

When rate limit is exceeded:

```json
{
  "code": "rate_limited",
  "message": "Too many requests. Please try again in 60 seconds.",
  "data": {
    "status": 429
  }
}
```

---

## Error Handling

### Error Response Format

```json
{
  "code": "error_code",
  "message": "Human-readable error message",
  "data": {
    "status": 400
  }
}
```

### Common Error Codes

| Code | Status | Description |
|------|--------|-------------|
| `rest_forbidden` | 403 | Insufficient permissions |
| `rate_limited` | 429 | Too many requests |
| `invalid_request` | 400 | Missing or invalid parameters |
| `not_found` | 404 | Resource not found |
| `db_error` | 500 | Database operation failed |
| `keyword_too_long` | 400 | Search keyword exceeds 500 characters |
| `invalid_date_format` | 400 | Invalid date format (use YYYY-MM-DD) |
| `relevance_out_of_range` | 400 | Relevance score must be between 0.0 and 1.0 |

---

## Best Practices

### 1. Use Pagination

Always use `limit` and `offset` for large result sets:

```bash
# First page
GET /content?limit=50&offset=0

# Second page
GET /content?limit=50&offset=50
```

### 2. Filter by Status

For AI processing, typically request only approved content:

```bash
GET /content?status=approved
```

### 3. Combine Filters

Filters can be combined for precise results:

```bash
GET /content?status=approved&min_relevance=0.7&after=2026-01-01&category=policy
```

### 4. Handle Rate Limits

Implement exponential backoff when receiving 429 responses:

```python
import time
import requests

def fetch_with_retry(url, headers, max_retries=3):
    for attempt in range(max_retries):
        response = requests.get(url, headers=headers)
        if response.status_code != 429:
            return response
        
        wait_time = 2 ** attempt  # 1s, 2s, 4s
        time.sleep(wait_time)
    
    raise Exception("Max retries exceeded")
```

### 5. Secure Your API Key

- Never commit API keys to version control
- Store keys in environment variables
- Rotate keys periodically
- Use HTTPS for all API requests

---

## Examples

### Python Example

```python
import requests

API_BASE = "https://your-site.com/wp-json/rawwire/v1"
API_KEY = "your_api_key_here"

headers = {
    "Authorization": f"Bearer {API_KEY}"
}

# Get approved content
response = requests.get(
    f"{API_BASE}/content",
    headers=headers,
    params={"status": "approved", "limit": 10}
)

data = response.json()
for item in data["items"]:
    print(f"{item['title']} (relevance: {item['relevance']})")

# Approve content
approve_response = requests.post(
    f"{API_BASE}/content/approve",
    headers=headers,
    json={
        "content_ids": [123, 456],
        "notes": "Approved by AI system"
    }
)

print(f"Approved {approve_response.json()['approved_count']} items")
```

### JavaScript Example

```javascript
const API_BASE = 'https://your-site.com/wp-json/rawwire/v1';
const API_KEY = 'your_api_key_here';

// Get approved content
async function getContent() {
  const response = await fetch(
    `${API_BASE}/content?status=approved&limit=10`,
    {
      headers: {
        'Authorization': `Bearer ${API_KEY}`
      }
    }
  );
  
  const data = await response.json();
  return data.items;
}

// Approve content
async function approveContent(contentIds, notes = '') {
  const response = await fetch(
    `${API_BASE}/content/approve`,
    {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${API_KEY}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        content_ids: contentIds,
        notes: notes
      })
    }
  );
  
  return await response.json();
}

// Usage
const content = await getContent();
console.log(`Found ${content.length} items`);

const result = await approveContent([123, 456], 'Approved by system');
console.log(`Approved ${result.approved_count} items`);
```

---

## Support

For API issues or questions:
- Check the [GitHub repository](https://github.com/raw-wire-dao-llc/raw-wire-core)
- Review the plugin documentation
- Contact your system administrator for API key management

---

**Last Updated**: January 2026  
**Version**: 1.0  
**Status**: Production Ready
